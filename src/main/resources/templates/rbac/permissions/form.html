<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title th:text="${permission.id != null} ? 'Edit Permission' : 'Create Permission'">Permission Form</title>
</head>
<body>
    <div layout:fragment="content">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-bsi-darker" 
                th:text="${permission.id != null} ? 'Edit Permission' : 'Create Permission'">Permission Form</h1>
            <a th:href="@{/rbac/permissions/list}" 
               class="bg-bsi-light-gray hover:bg-bsi-gray text-white font-bold py-2 px-4 rounded"
               id="back-to-list-btn">
                Back to List
            </a>
        </div>

        <!-- Error Messages -->
        <div th:if="${errorMessage}" 
             class="bg-bsi-secondary bg-opacity-20 border border-bsi-secondary text-bsi-secondary px-4 py-3 rounded mb-4"
             id="error-message">
            <span th:text="${errorMessage}"></span>
        </div>

        <!-- Success Messages -->
        <div th:if="${successMessage}" 
             class="bg-bsi-success bg-opacity-20 border border-bsi-success text-bsi-success px-4 py-3 rounded mb-4"
             id="success-message">
            <span th:text="${successMessage}"></span>
        </div>

        <div class="bg-white shadow rounded-lg p-6">
            <form th:action="${permission.id != null} ? @{/rbac/permissions/edit/{id}(id=${permission.id})} : @{/rbac/permissions/create}" 
                  method="post" 
                  th:object="${permission}"
                  id="permission-form">
                
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                    <!-- Permission Code -->
                    <div>
                        <label for="permissionCode" class="block text-sm font-medium text-bsi-dark">Permission Code *</label>
                        <input type="text" 
                               id="permissionCode" 
                               th:field="*{permissionCode}"
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-bsi-primary focus:border-bsi-primary"
                               th:classappend="${#fields.hasErrors('permissionCode')} ? 'border-bsi-secondary' : ''"
                               placeholder="e.g., USER_VIEW, ACCOUNT_CREATE"
                               required>
                        <p th:if="${#fields.hasErrors('permissionCode')}" 
                           th:errors="*{permissionCode}" 
                           class="mt-1 text-sm text-bsi-secondary permissioncode-error"
                           id="permissionCode-error"></p>
                    </div>

                    <!-- Permission Name -->
                    <div>
                        <label for="permissionName" class="block text-sm font-medium text-bsi-dark">Permission Name *</label>
                        <input type="text" 
                               id="permissionName" 
                               th:field="*{permissionName}"
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-bsi-primary focus:border-bsi-primary"
                               th:classappend="${#fields.hasErrors('permissionName')} ? 'border-bsi-secondary' : ''"
                               placeholder="e.g., Read User Data, Write Account Data"
                               required>
                        <p th:if="${#fields.hasErrors('permissionName')}" 
                           th:errors="*{permissionName}" 
                           class="mt-1 text-sm text-bsi-secondary permissionname-error"
                           id="permissionName-error"></p>
                    </div>

                    <!-- Permission Category -->
                    <div>
                        <label for="permissionCategory" class="block text-sm font-medium text-bsi-dark">Category *</label>
                        <input type="text" 
                               id="permissionCategory" 
                               th:field="*{permissionCategory}"
                               list="category-suggestions"
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-bsi-primary focus:border-bsi-primary"
                               th:classappend="${#fields.hasErrors('permissionCategory')} ? 'border-bsi-secondary' : ''"
                               placeholder="e.g., USER, ACCOUNT, TRANSACTION"
                               required>
                        <datalist id="category-suggestions">
                            <option th:each="cat : ${categories}" th:value="${cat}"></option>
                        </datalist>
                        <p th:if="${#fields.hasErrors('permissionCategory')}" 
                           th:errors="*{permissionCategory}" 
                           class="mt-1 text-sm text-bsi-secondary permissioncategory-error"
                           id="permissionCategory-error"></p>
                    </div>

                    <!-- Resource -->
                    <div>
                        <label for="resource" class="block text-sm font-medium text-bsi-dark">Resource</label>
                        <input type="text" 
                               id="resource" 
                               th:field="*{resource}"
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-bsi-primary focus:border-bsi-primary"
                               th:classappend="${#fields.hasErrors('resource')} ? 'border-bsi-secondary' : ''"
                               placeholder="e.g., user, account, transaction">
                        <p th:if="${#fields.hasErrors('resource')}" 
                           th:errors="*{resource}" 
                           class="mt-1 text-sm text-bsi-secondary resource-error"></p>
                    </div>

                    <!-- Action -->
                    <div>
                        <label for="action" class="block text-sm font-medium text-bsi-dark">Action</label>
                        <input type="text" 
                               id="action" 
                               th:field="*{action}"
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-bsi-primary focus:border-bsi-primary"
                               th:classappend="${#fields.hasErrors('action')} ? 'border-bsi-secondary' : ''"
                               placeholder="e.g., read, write, delete, create">
                        <p th:if="${#fields.hasErrors('action')}" 
                           th:errors="*{action}" 
                           class="mt-1 text-sm text-bsi-secondary action-error"></p>
                    </div>

                    <!-- Description -->
                    <div class="sm:col-span-2">
                        <label for="description" class="block text-sm font-medium text-bsi-dark">Description</label>
                        <textarea id="description" 
                                  th:field="*{description}"
                                  rows="3"
                                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-bsi-primary focus:border-bsi-primary"
                                  th:classappend="${#fields.hasErrors('description')} ? 'border-bsi-secondary' : ''"
                                  placeholder="Describe what this permission allows..."></textarea>
                        <p th:if="${#fields.hasErrors('description')}" 
                           th:errors="*{description}" 
                           class="mt-1 text-sm text-bsi-secondary description-error"></p>
                    </div>
                </div>

                <div class="mt-6 flex justify-end space-x-3">
                    <a th:href="@{/rbac/permissions/list}" 
                       class="bg-bsi-bg-light hover:bg-gray-400 text-bsi-dark font-bold py-2 px-4 rounded"
                       id="cancel-btn">
                        Cancel
                    </a>
                    <button type="submit" 
                            class="bg-bsi-primary hover:bg-bsi-teal text-white font-bold py-2 px-4 rounded"
                            id="save-permission-btn">
                        <span th:text="${permission.id != null} ? 'Update Permission' : 'Create Permission'">Save</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>