<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title th:text="'Set Password - ' + ${user.username}">Set Password</title>
</head>
<body>
    <div layout:fragment="content">
        <div class="flex justify-between items-center mb-6">
            <h1 id="page-title" class="text-3xl font-bold text-gray-800" 
                th:text="'Set Password for ' + ${user.username}">Set Password</h1>
            <div class="space-x-2">
                <a th:href="@{/rbac/users/view/{id}(id=${user.id})}" 
                   class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"
                   id="back-to-view-btn">
                    Back to User
                </a>
                <a th:href="@{/rbac/users/list}" 
                   class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"
                   id="back-to-list-btn">
                    Back to List
                </a>
            </div>
        </div>

        <!-- Error Messages -->
        <div th:if="${errorMessage}" 
             class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"
             id="error-message">
            <span th:text="${errorMessage}"></span>
        </div>

        <!-- Success Messages -->
        <div th:if="${successMessage}" 
             class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4"
             id="success-message">
            <span th:text="${successMessage}"></span>
        </div>

        <div class="bg-white shadow rounded-lg p-6">
            <!-- User Info -->
            <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                <h3 class="text-lg font-medium text-gray-900 mb-2">User Information</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <span class="text-sm font-medium text-gray-500">Username:</span>
                        <span class="text-sm text-gray-900" th:text="${user.username}"></span>
                    </div>
                    <div>
                        <span class="text-sm font-medium text-gray-500">Full Name:</span>
                        <span class="text-sm text-gray-900" th:text="${user.fullName}"></span>
                    </div>
                    <div>
                        <span class="text-sm font-medium text-gray-500">Email:</span>
                        <span class="text-sm text-gray-900" th:text="${user.email}"></span>
                    </div>
                    <div>
                        <span class="text-sm font-medium text-gray-500">Status:</span>
                        <span th:if="${user.isActive}" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                            Active
                        </span>
                        <span th:unless="${user.isActive}" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                            Inactive
                        </span>
                    </div>
                </div>
            </div>

            <!-- Password Form -->
            <form th:action="@{/rbac/users/{id}/password(id=${user.id})}" 
                  method="post" 
                  id="password-form">
                
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                    <!-- Password -->
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">New Password *</label>
                        <input type="password" 
                               id="password" 
                               name="password"
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               minlength="6"
                               required>
                        <p class="mt-1 text-sm text-gray-500">Minimum 6 characters required.</p>
                    </div>

                    <!-- Confirm Password -->
                    <div>
                        <label for="confirmPassword" class="block text-sm font-medium text-gray-700">Confirm Password *</label>
                        <input type="password" 
                               id="confirmPassword" 
                               name="confirmPassword"
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               minlength="6"
                               required>
                        <p class="mt-1 text-sm text-gray-500">Must match the password above.</p>
                    </div>
                </div>

                <div class="mt-6 flex justify-end space-x-3">
                    <a th:href="@{/rbac/users/view/{id}(id=${user.id})}" 
                       class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded"
                       id="cancel-btn">
                        Cancel
                    </a>
                    <button type="submit" 
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                            id="save-password-btn">
                        Set Password
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Client-side password confirmation validation
        document.getElementById('password-form').addEventListener('submit', function(e) {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                e.preventDefault();
                alert('Passwords do not match. Please check and try again.');
                return false;
            }
            
            if (password.length < 6) {
                e.preventDefault();
                alert('Password must be at least 6 characters long.');
                return false;
            }
        });
    </script>
</body>
</html>